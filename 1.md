## 任務拆分 - clearAllTasks 模式

## 拆分策略

1. **按功能分解** - 獨立可測試的子功能，明確輸入輸出
2. **按技術層次分解** - 沿架構層次分離任務，確保接口明確
3. **按開發階段分解** - 核心功能先行，優化功能後續
4. **按風險分解** - 隔離高風險部分，降低整體風險

## 任務質量審核

1. **任務原子性** - 每個任務足夠小且具體，可獨立完成
2. **依賴關係** - 任務依賴形成有向無環圖，避免循環依賴
3. **描述完整性** - 每個任務描述清晰準確，包含必要上下文

## 任務清單

### 任務 1：任务1：配置测试依赖与环境

**ID:** `5cb34019-640d-49e5-81bb-7d73f9305591`
**描述:** 在 `Cargo.toml` 中添加测试所需的开发依赖，并配置一个 `.env.test` 文件来管理测试环境的特定变量，如测试数据库的 URL。同时，更新 `.gitignore` 以避免追踪测试数据库文件。

**注意事項:** no notes

**實現指南:** 1. 编辑 `Cargo.toml`，在 `[dev-dependencies]` 部分添加 `reqwest`, `once_cell`, `wiremock`, 和 `serde_json`。 2...

**驗證標準:** 运行 `cargo check` 顺利通过。`Cargo.toml` 中包含新的依赖项。`.env.test` 文件已创建并包含正确的数据库连接字符串。`.gitignore` 已更新。

**依賴任務:** 

### 任務 2：任务2：创建集成测试的通用辅助模块

**ID:** `92402f03-801f-4cac-8f36-ead389643830`
**描述:** 在 `tests` 目录下创建 `common/mod.rs` 文件，用于存放测试共享的辅助函数。核心是实现一个 `spawn_app` 函数，负责启动测试服务器和设置测试数据库。

**注意事項:** no notes

**實現指南:** 1. 创建 `tests/common` 目录和 `tests/common/mod.rs` 文件。 2. 在文件中定义一个 `spawn_app` 异步函数。该函数应该： a. 使用 `once_c...

**驗證標準:** 辅助模块可以被其他集成测试文件引用。`spawn_app` 函数能够成功启动一个应用实例并连接到测试数据库，且数据库迁移已执行。

**依賴任務:** "任务1：配置测试依赖与环境" (`5cb34019-640d-49e5-81bb-7d73f9305591`)

### 任務 3：任务3：实现仓库层 (Repository) 集成测试

**ID:** `4dc22b2e-9d0d-452f-ae7b-f3fd3f4e4dee`
**描述:** 为 `TaskRepository` 编写集成测试，验证其所有功能（增删改查）在真实的测试数据库中都能正确工作。

**注意事項:** no notes

**實現指南:** 1. 创建 `tests/task_repository_tests.rs` 文件。 2. 在文件中 `use` 通用辅助模块。 3. 为 `create`, `find_by_id`, `get_a...

**驗證標準:** 所有仓库层的测试用例都能通过 (`cargo test --test task_repository_tests`)。测试覆盖了所有公开的 repository 函数。

**依賴任務:** "任务2：创建集成测试的通用辅助模块" (`92402f03-801f-4cac-8f36-ead389643830`)

### 任務 4：任务4：为服务层 (Service) 解耦以支持单元测试

**ID:** `d063a1f2-c7bf-46ff-bb5b-fb6b0de2ca7d`
**描述:** 重构 `TaskService`，使其不直接依赖于具体的 `TaskRepository` 类型，而是依赖于一个抽象的 Trait。这是实现服务层纯单元测试（无数据库依赖）的关键前提。

**注意事項:** no notes

**實現指南:** 1. 在 `task_repository.rs` 模块的命名空间下定义一个 `pub trait TaskRepositoryContract: Send + Sync { ... }`。 2. 在...

**驗證標準:** 重构后，整个项目依然可以通过 `cargo check`。`TaskService` 不再与具体的 `TaskRepository` 结构体耦合，而是依赖于抽象的 `TaskRepositoryCon...

**依賴任務:** "任务3：实现仓库层 (Repository) 集成测试" (`4dc22b2e-9d0d-452f-ae7b-f3fd3f4e4dee`)

### 任務 5：任务5：实现服务层 (Service) 单元测试

**ID:** `8062feb4-3442-4b8d-9025-98fac5fc8b55`
**描述:** 为 `TaskService` 编写单元测试，使用模拟（Mock）的 `TaskRepository` 来隔离测试环境，只验证业务逻辑的正确性。

**注意事項:** no notes

**實現指南:** 1. 在 `src/app/service/task_service.rs` 的测试模块 (`#[cfg(test)]`) 中，创建一个模拟的 `MockTaskRepository` 结构体。 2....

**驗證標準:** 所有服务层的单元测试用例都能通过 (`cargo test --lib`)。测试覆盖了 `TaskService` 的核心业务逻辑，包括成功和失败的场景。

**依賴任務:** "任务4：为服务层 (Service) 解耦以支持单元测试" (`d063a1f2-c7bf-46ff-bb5b-fb6b0de2ca7d`)

### 任務 6：任务6：实现 API 层 (Controller) 端到端集成测试

**ID:** `e237091d-341e-43ae-9995-b410fc297832`
**描述:** 为任务管理的 API 端点 (`/api/tasks`) 编写端到端的集成测试，模拟真实的 HTTP 客户端调用，验证整个请求-响应链路。

**注意事項:** no notes

**實現指南:** 1. 创建 `tests/task_api_tests.rs` 文件。 2. 在测试文件中，使用 `common::spawn_app().await` 启动完整的测试服务器并获取其地址。 3. 使用...

**驗證標準:** 所有 API 层的集成测试都能通过 (`cargo test --test task_api_tests`)。测试覆盖了所有任务相关的 API 端点和 HTTP 方法。

**依賴任務:** "任务2：创建集成测试的通用辅助模块" (`92402f03-801f-4cac-8f36-ead389643830`), "任务5：实现服务层 (Service) 单元测试" (`8062feb4-3442-4b8d-9025-98fac5fc8b55`)

### 任務 7：任务7：验证数据库迁移功能

**ID:** `b39158f2-24aa-4092-934a-8e1b78dd5047`
**描述:** 编写一个专门的测试来验证数据库迁移逻辑是否能够正确执行，以及应用在启动时是否能处理空的或已存在的数据库。

**注意事項:** no notes

**實現指南:** 1. 创建 `tests/migration_tests.rs` 文件。 2. **测试1 (空数据库初始化)**: a. 手动删除测试数据库文件（如果存在）。 b. 调用 `common::spaw...

**驗證標準:** 迁移测试用例可以通过 (`cargo test --test migration_tests`)。测试证明了迁移的幂等性和在空数据库上的初始化能力。

**依賴任務:** "任务2：创建集成测试的通用辅助模块" (`92402f03-801f-4cac-8f36-ead389643830`)


## 依賴關係管理

- 設置依賴可使用任務名稱或任務 ID
- 最小化依賴數量，只設置直接前置任務
- 避免循環依賴，確保任務圖有向無環
- 平衡關鍵路徑，優化並行執行可能性

## 決策點

- 發現任務拆分不合理：重新呼叫「split_tasks」調整
- 確認任務拆分完善：生成執行計劃，確定優先順序

**嚴重警告** 你每次呼叫 split_tasks 傳遞的參數不能超過 5000 個字，如果超出 5000 個字請多次呼叫工具完成

**如果還有剩餘任務請繼續呼叫「split_tasks」**



