### **项目史诗：实现企业级认证与访问控制**

**1. 项目目标 (Project Goal)**

将当前的 Axum 任务管理系统从一个公开访问的演示应用，升级为一个安全、健壮、支持多用户的生产级服务。此举的核心是通过实现业界标准的认证、授权和输入验证机制，确保数据的私密性、完整性和安全性。

**2. 核心特性 (Key Features)**

-   **特性 1：用户身份模块 (User Identity Module)**
    -   **描述**: 使用 `SeaORM` 创建一个新的 `users` 表，并定义 `User` 实体。该表需包含 `id`, `username`, `password_hash` 等关键字段。同时，在 `tasks` 表中添加 `user_id` 字段，建立用户与任务之间的一对多关系。
    -   **关键技术**: `SeaORM` 实体定义、数据库迁移、表关联。

-   **特性 2：用户注册端点 (User Registration Endpoint)**
    -   **描述**: 创建 `POST /api/auth/register` API。该端点接收用户凭证（如用户名、密码），并使用安全的哈希算法（如 `bcrypt` 或 `argon2`）处理密码后，将新用户存入数据库。
    -   **关键技术**: 密码学哈希、安全的密码处理。

-   **特性 3：用户登录与 JWT 签发 (User Login & JWT Issuance)**
    -   **描述**: 创建 `POST /api/auth/login` API。该端点验证用户凭证，成功后生成一个包含用户身份信息（如 `user_id`）的 JSON Web Token (JWT) 并返回给客户端。
    -   **关键技术**: JWT 规范 (Claims)、数字签名、Token 生命周期管理。

-   **特性 4：可复用的输入验证提取器 (Reusable Validation Extractor)**
    -   **描述**: 创建一个自定义的 Axum `Extractor`，它能自动解析请求体 (JSON) 并使用 `validator` crate 对其进行验证。如果验证失败，应直接返回一个明确的 `422 Unprocessable Entity` 错误响应。
    -   **关键技术**: Axum `Extractor` (`FromRequest`), `validator` crate。

-   **特性 5：JWT 认证中间件与路由保护 (JWT Auth Middleware & Route Protection)**
    -   **描述**: 开发一个 Axum 中间件，它能从请求头中提取 JWT，验证其有效性（签名、未过期）。将此中间件应用于所有任务相关的 API (`/api/tasks/*`)，确保只有携带有效 Token 的请求才能访问。同时，在任务相关的操作中，确保用户只能操作属于自己的任务（授权）。
    -   **关键技术**: Axum 中间件 (`middleware::from_fn`)、路由保护、所有权/授权检查。

    - **渐进式开发**：将大任务分解为小的、可验证的步骤
    - **代码清理**：完成新功能后删除旧的实现代码

**3. 验收标准 (Acceptance Criteria)**


-   [ ] 未经认证的用户访问 `/api/tasks` 时，必须收到 `401 Unauthorized` 响应。
-   [ ] 使用无效或过期的 Token 访问受保护路由时，必须收到 `401 Unauthorized` 响应。
-   [ ] 用户 A 尝试访问或修改用户 B 创建的任务时，必须收到 `403 Forbidden` 或 `404 Not Found` 响应。
-   [ ] 提交不符合验证规则的注册或登录数据（如用户名过短、密码为空）时，必须收到 `422 Unprocessable Entity` 响应，并包含清晰的错误字段说明。
-   [ ] 数据库中绝对不能以明文形式存储任何用户密码。
-   [ ] 所有新添加的业务逻辑（服务、仓库）和关键功能（中间件、提取器）都必须有对应的单元测试或集成测试。

     之后进行全面的边缘情况测试
### 环境管理
- **环境隔离**：确保开发、测试、生产环境的独立性
- **配置管理**：使用环境变量管理敏感配置（数据库连接、JWT 密钥等）
- **依赖控制**：优先使用现有依赖，避免引入不必要的新技术

**4. 核心学习目标 (Core Learning Objectives)**

-   深入理解 `SeaORM` 的实体关系和迁移管理。
-   掌握 Rust 中密码哈希的最佳实践。
-   精通 JWT 的创建、签发和验证流程。
-   熟练编写自定义的 Axum 中间件和请求提取器。
-   构建一个统一、分层的错误处理系统，能将不同类型的错误（数据库、验证、认证）优雅地映射为对应的 HTTP 状态码。
-   实践测试驱动开发（TDD）来保证认证系统的健壮性。 
